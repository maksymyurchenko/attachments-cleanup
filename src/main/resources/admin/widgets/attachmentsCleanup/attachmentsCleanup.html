<widget>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"
  />
  <title>Attachments Cleanup</title>
  <link
    rel="stylesheet"
    data-th-href="${portal.assetUrl({'_path=style/main.css'})}"
  />
  <div data-th-each="attachment : ${attachments}">
    <div class="attachment">
      <span class="attachmentName" data-th-utext="${attachment.name}"></span>
      <div
        class="attachmentRemoveButton"
        data-th-attr="data-cid=${id}, data-name=${attachment.name}"
      ></div>
    </div>
  </div>
  <script
    data-th-widget-id="${widgetId}"
    data-th-src="${portal.assetUrl({'_path=js/jquery-3.3.1.min.js'})}"
  ></script>
  <script data-th-widget-id="${widgetId}" data-th-inline="javascript">
    var serviceUrl = [[${serviceUrl}]];
    function checkJqeury(){
      if($){
        init();
      }
      else {
        console.log("waiting");
        setTimeout(checkJqeury, 1000); // check again in a second
      }
    }
    function init(){
      $(".attachmentRemoveButton").on("click", function() {
        var data = $(this).data();
        $.ajax({
          url: serviceUrl,
          type: "POST",
          data: data,
          success: function(data) {
            console.log("good");
          }
        });
      });
    }
    checkJqeury();
  </script>
</widget>
